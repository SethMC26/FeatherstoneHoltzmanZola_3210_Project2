<!DOCTYPE html>
<html>
  <head>
    <title>Starfield Example</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background-color: #111; /* Set the background to dark */
        overflow: hidden; /* Hide scrollbars */
      }

      canvas {
        display: block; /* Remove default spacing */
      }
    </style>
  </head>
  <body>
    <canvas id="outerspace" height="500" width="500"></canvas>

    <script type="module" src="src/game.js"></script>
    <script>
      // Query the canvas element
      let outerspace = document.querySelector("#outerspace");
      let mainContext = outerspace.getContext("2d");
      let canvasWidth, canvasHeight;

      let centerX = canvasWidth * 0.5;
      let centerY = canvasHeight * 0.5;

      // Adjust canvas size to full screen
      function resizeCanvas() {
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;
        outerspace.width = canvasWidth;
        outerspace.height = canvasHeight;
      }

      window.addEventListener("resize", resizeCanvas); // Resize on window change
      resizeCanvas(); // Initial sizing

      let numberOfStars = 500;
      let stars = [];

      // Star class
      class Star {
        constructor() {
          this.x = getRandomInt(0, canvasWidth);
          this.y = getRandomInt(0, canvasHeight);
          this.counter = canvasWidth;
          this.radius = 1 + Math.random() * 10;
          this.context = mainContext;
        }

        drawStar() {
          this.counter -= 1;

          let xRatio = this.x / this.counter;
          let yRatio = this.y / this.counter;

          let starX = remap(xRatio, 0, 1, 0, canvasWidth);
          let starY = remap(yRatio, 0, 1, 0, canvasHeight);

          mainContext.beginPath();
          mainContext.arc(starX, starY, this.radius, 0, Math.PI * 2, false);
          mainContext.closePath();
          mainContext.fillStyle = "#FFF"; // White stars
          mainContext.fill();
        }
      }

      // Initialize stars
      function setup() {
        for (let i = 0; i < numberOfStars; i++) {
          stars.push(new Star());
        }
      }
      setup();

      // Draw all stars on the canvas
      function draw() {
        mainContext.clearRect(0, 0, canvasWidth, canvasHeight);
        mainContext.fillStyle = "#111";
        mainContext.fillRect(0, 0, canvasWidth, canvasHeight); // Clear the canvas before drawing
        for (let i = 0; i < stars.length; i++) {
          stars[i].drawStar();
        }
        requestAnimationFrame(draw);
      }
      draw();

      // Function to generate random integers between min and max
      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      //SOURCE: https://www.kirupa.com/animations/animated_3d_starfield_effect.htm
      function remap(value, istart, istop, ostart, ostop) {
        // Ensure values are numerical to avoid potential errors
        value = Number(value);
        istart = Number(istart);
        istop = Number(istop);
        ostart = Number(ostart);
        ostop = Number(ostop);

        // Perform the mapping calculation
        return (
          ostart + (ostop - ostart) * ((value - istart) / (istop - istart))
        );
      }
    </script>
  </body>
</html>
